<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro</title>
    
    <link rel="stylesheet" href="/pages/financeiro.page/financeiro.css">
    <link rel="stylesheet" href="/pages/styles/global.css"> 
    <link rel="stylesheet" href="/components/menu.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body data-theme="light">
<header id="menu-placeholder">
    <nav class="menu">
        <div class="menu-lado-esquerdo">
            <div class="hamburger-menu hamburger-mobile" id="hamburger-btn-mobile"><i class='bx bx-menu'></i></div>
            <img src="/pages/logo.tab.png" alt="logo-tab" width="65" class="menu-logo" id="menu-logo-img" />
            <h3 id="menu-church-name">ADTC - Tabernáculo Celeste</h3>
        </div>
        <div class="menu-acoes">
            <div class="notificacao-container" id="notificacao-container"><i class='bx bxs-bell'></i><span class="notificacao-contador" id="notificacao-contador"></span></div>
            <div class="conta-area" id="conta-area-trigger">
                <div id="user-avatar" class="user-avatar">U</div>
            </div>
        </div>
    </nav>
    <aside class="sub-menu">
        <div class="hamburger-menu hamburger-desktop" id="hamburger-btn-desktop"><i class='bx bx-menu'></i></div>
        <div class="menu-categorias">
            <a href="/pages/dashboard/dashboard.html" class="sub-menu-link">Dashboard</a>
            <a href="/pages/cadastro.page/cadastro.html" class="sub-menu-link">Cadastro</a>
            <a href="/pages/lista.membros/lista.membros.html" class="sub-menu-link">Membros</a>
            <a href="/pages/financeiro.page/financeiro.html" class="sub-menu-link">Financeiro</a>
            <a href="/pages/utensilios/utensilios.html" class="sub-menu-link">Utensílios</a>
            <a href="/pages/eventos/eventos.html" class="sub-menu-link">Eventos</a>
        </div>
    </aside>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    <nav id="sidebar-menu" class="sidebar">
        <div class="sidebar-header">
            <h4>Navegação Principal</h4>
            <i class='bx bx-x' id="sidebar-close-btn"></i>
        </div>
        <ul class="sidebar-links">
            <li><a href="/pages/dashboard/dashboard.html"><i class='bx bxs-dashboard'></i> Dashboard</a></li>
            <li>
                <details><summary><i class='bx bxs-user-plus'></i> Cadastros</summary>
                    <ul>
                        <li><a href="/pages/cadastro.page/cadastro.html">- Central de Cadastros</a></li>
                        <li><a href="/pages/cadastro.membro.page/cadastro.membro.html">- Novo Membro</a></li>
                        <li><a href="/pages/cadastro.page/visitantes.html">- Visitantes</a></li>
                    </ul>
                </details>
            </li>
            <li>
                <details><summary><i class='bx bxs-group'></i> Membros</summary>
                    <ul><li><a href="/pages/lista.membros/lista.membros.html#lista">- Lista de Membros</a></li><li><a href="/pages/lista.membros/lista.membros.html#presenca">- Controle de Presença</a></li></ul>
                </details>
            </li>
            <li>
                <details><summary><i class='bx bxs-dollar-circle'></i> Financeiro</summary>
                    <ul><li><a href="/pages/financeiro.page/financeiro.html#lancamentos">- Lançamentos</a></li><li><a href="/pages/financeiro.page/financeiro.html#dizimos">- Dízimos e Ofertas</a></li></ul>
                </details>
            </li>
            <li>
                <details><summary><i class='bx bxs-home-heart'></i> Pequenos Grupos</summary>
                    <ul><li><a href="/pages/pequenos-grupos/pequenos-grupos.html#painel-grupos">- Painel de Grupos</a></li><li><a href="/pages/pequenos-grupos/pequenos-grupos.html#analise-geral">- Análise Geral</a></li></ul>
                </details>
            </li>
            <li>
                <details><summary><i class='bx bxs-box'></i> Utensílios</summary>
                    <ul><li><a href="/pages/utensilios/utensilios.html#inventario">- Inventário</a></li><li><a href="/pages/utensilios/utensilios.html#emprestimos">- Empréstimos</a></li><li><a href="/pages/utensilios/utensilios.html#manutencao">- Manutenção</a></li></ul>
                </details>
            </li>
            <li>
                <details><summary><i class='bx bxs-calendar-event'></i> Eventos</summary>
                    <ul><li><a href="/pages/eventos/eventos.html#painel">- Painel de Eventos</a></li></ul>
                </details>
            </li>
            <hr>
            <li><a href="/pages/configuracoes/configuracoes.html"><i class='bx bxs-cog'></i> Configurações</a></li>
            <li>
                <details><summary><i class='bx bxs-info-circle'></i> Sobre</summary>
                    <div class="sidebar-sobre"><p><strong>Versão:</strong> 1.0.0</p><a href="#" target="_blank">Site do Desenvolvedor</a></div>
                </details>
            </li>
        </ul>
    </nav>
</header>

<main class="conteudo">
    <h1 class="title-page">Painel Financeiro</h1>

    <div class="abas-financeiro">
        <button class="aba-link active" data-aba="lancamentos">Lançamentos</button>
        <button class="aba-link" data-aba="dizimos">Dízimos e Ofertas</button>
    </div>

    <div id="lancamentos" class="aba-conteudo active">
        <section class="dashboard-financeiro">
            <div class="card-dashboard" id="card-receitas"><p>Receitas (Período)</p><h2 id="total-receitas">R$ 0,00</h2></div>
            <div class="card-dashboard" id="card-despesas"><p>Despesas (Período)</p><h2 id="total-despesas">R$ 0,00</h2></div>
            <div class="card-dashboard" id="card-saldo"><p>Balanço (Período)</p><h2 id="balanco-mensal">R$ 0,00</h2></div>
        </section>
        
        <div class="analises-container">
            <section class="grafico-container">
                <div class="grafico-header">
                    <h3>Resumo Anual (<span id="grafico-ano-titulo"></span>)</h3>
                </div>
                <div id="grafico-body" class="grafico-body">
                    <canvas id="grafico-mensal"></canvas>
                </div>
            </section>
            <section class="grafico-container">
                <div class="grafico-header">
                    <h3>Despesas por Categoria (Período)</h3>
                </div>
                <div class="grafico-body" id="grafico-pizza-container"><canvas id="grafico-despesas-pizza"></canvas></div>
            </section>
        </div>

        <section class="lancamentos-container">
            <div class="lancamentos-header">
                <h2>Extrato de Lançamentos</h2>
                <div class="header-actions">
                    <button id="btn-excluir-selecionados" class="btn-perigo hidden"><i class='bx bxs-trash'></i> Excluir Selecionados</button>
                    <button id="btn-exportar-pdf" class="btn-secundario"><i class='bx bxs-file-pdf'></i> Exportar PDF</button>
                    <button id="btn-novo-lancamento" class="btn-principal">+ Novo Lançamento</button>
                </div>
            </div>
            
            <div class="filtros-container">
                <label for="filtro-ano">Ano:</label>
                <select id="filtro-ano"></select>
                <label for="filtro-mes">Mês:</label>
                <select id="filtro-mes"></select>
                <label for="filtro-categoria">Categoria:</label>
                <select id="filtro-categoria"></select>
                <label for="filtro-tipo">Tipo:</label>
                <select id="filtro-tipo">
                    <option value="todos">Todos</option>
                    <option value="entrada">Entradas</option>
                    <option value="saida">Saídas</option>
                </select>
            </div>

            <table class="tabela-lancamentos">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selecionar-todos-lancamentos" title="Selecionar Todos"></th>
                        <th>Data</th><th>Descrição</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                        <th>Ações</th>
                    </tr></thead>
                <tbody id="tabela-lancamentos-corpo"></tbody>
            </table>
        </section>
    </div>

    <div id="dizimos" class="aba-conteudo">
    <section class="dizimos-busca-container">
        <h2>Controle de Contribuições por Membro</h2>
        <p>Busque um membro pelo nome para visualizar ou registrar dízimos e ofertas.</p>
        <div class="form-group">
            <input type="text" id="busca-membro-input" placeholder="Digite o nome do membro..." autocomplete="off">
            <div id="busca-membro-resultados"></div>
        </div>
    </section>

    <section id="historico-membro-container" class="hidden">
        <div class="historico-header">
            <div>
                <p class="historico-subtitulo">Histórico de Contribuições de:</p>
                <h3 id="historico-membro-nome"></h3>
            </div>
            <div class="header-actions">
                <button id="btn-imprimir-relatorio-membro" class="btn-secundario"><i class='bx bxs-printer'></i> Imprimir Relatório</button>
                <button id="btn-novo-dizimo-membro" class="btn-principal">+ Nova Contribuição</button>
            </div>
        </div>

        <div class="dashboard-financeiro-membro">
             <div class="card-dashboard" id="card-total-anual">
                 <p>Total Contribuído (<span id="ano-corrente-historico"></span>)</p>
                 <h2 id="total-anual-membro">R$ 0,00</h2>
             </div>
        </div>

        <section class="grafico-container-membro">
            <div class="grafico-header">
                <h3>Contribuições Mensais (<span id="grafico-ano-membro"></span>)</h3>
            </div>
            <div id="grafico-contribuicoes-container" class="grafico-body"></div>
        </section>
        
        <table class="tabela-lancamentos">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Categoria</th>
                    <th>Descrição</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody id="tabela-historico-corpo">
                </tbody>
             <tfoot>
                <tr>
                    <td colspan="3">Total Geral do Histórico</td>
                    <td id="total-geral-historico">R$ 0,00</td>
                </tr>
            </tfoot>
        </table>
        
        <div id="aviso-sem-historico" class="aviso-historico hidden">
            <p>Nenhuma contribuição encontrada para este membro.</p>
        </div>
    </section>
    
    <section id="aviso-inicial-dizimos" class="aviso-historico">
        <i class='bx bx-search-alt' style="font-size: 4rem; color: #ccc;"></i>
        <p>Utilize a busca acima para encontrar um membro.</p>
    </section>
</div>
</main>
    
<div id="modal-lancamento" class="modal-overlay">
    <div class="modal-content">
        <form id="form-lancamento">
            <h2 id="modal-titulo">Novo Lançamento</h2>
            <div class="form-group"><label for="tipo">Tipo de Lançamento</label><select id="tipo" required><option value="entrada">Entrada (Receita)</option><option value="saida">Saída (Despesa)</option></select></div>
            <div class="form-group"><label for="data">Data</label><input type="date" id="data" required></div>
            <div class="form-group"><label for="valor">Valor (R$)</label><input type="number" step="0.01" min="0" id="valor" placeholder="Ex: 150.00" required></div>
            <div class="form-group"><label for="categoria">Categoria</label><select id="categoria" required></select></div>
            <div class="form-group hidden" id="grupo-membro"><label for="membroId">Membro (Opcional para Dízimos/Ofertas)</label><select id="membroId"></select></div>
            <div class="form-group"><label for="descricao">Descrição</label><input type="text" id="descricao" placeholder="Ex: Dízimo, Oferta de Missões, Conta de Luz" required></div>
            <div class="form-group"><label for="comprovante">Anexar Comprovante (Opcional)</label><input type="file" id="comprovante" accept="image/*,application/pdf"></div>
            <div id="comprovante-atual-container" class="form-group hidden"><p>Comprovante Atual: <a id="comprovante-atual-link" href="#" target="_blank"></a></p></div>
            <div class="modal-actions"><button type="button" class="btn-secundario" data-close>Cancelar</button><button type="submit" class="btn-principal">Salvar</button></div>
        </form>
    </div>
</div>

<!-- Toast/Snackbar para Desfazer Exclusão -->
<div id="toast-desfazer" class="toast">
    <span id="toast-mensagem"></span>
    <button id="btn-desfazer" class="btn-toast">Desfazer</button>
</div>

<!-- Bibliotecas para Geração de PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<script src="/pages/config.js"></script>
<script src="/components/menu.js"></script>
<script src="/pages/financeiro.page/financeiro.js"></script>
</body>
</html>