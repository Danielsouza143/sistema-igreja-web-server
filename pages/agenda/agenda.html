<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- O Guardião deve ser o PRIMEIRO script a ser carregado -->
    <script src="/auth-guard.js"></script>

    <title>Agenda da Igreja</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <link rel="stylesheet" href="/pages/styles/global.css">
    <link rel="stylesheet" href="/components/menu.css">
    <link rel="stylesheet" href="/components/notifications.css"> <!-- NOVO -->
    <link rel="stylesheet" href="/pages/styles/tabelas-abas.css">
    <link rel="stylesheet" href="agenda.css">
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
</head>
<body>

<header id="menu-placeholder"></header>

<main class="conteudo">
    <div class="header-pagina">
        <h2>Agenda e Eventos</h2>
        <div class="acoes-header">
            <div id="calendar-zoom-controls">
                <button id="btn-zoom-out" class="btn btn-secundario">-</button>
                <button id="btn-zoom-in" class="btn btn-secundario">+</button>
            </div>
            <button id="btn-novo-evento" class="btn btn-principal">
                <i class='bx bx-plus'></i> Novo Lançamento
            </button>
        </div>
    </div>

    <div class="container-abas">
        <div class="abas-links">
            <button id="tab-calendario" class="aba-link active">Calendário</button>
            <button id="tab-lista" class="aba-link">Lista</button>
        </div>
        <div class="abas-conteudo-wrapper">
            <div id="view-calendario" class="aba-conteudo active">
                <div id="calendario"></div>
            </div>
            <div id="view-lista" class="aba-conteudo">
                <div id="lista-eventos-container"></div>
            </div>
        </div>
    </div>
</main>

<div id="evento-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modal-title">Novo Evento</h2>
            <button class="modal-close">&times;</button>
        </div>
        <form id="evento-form">
            <input type="hidden" id="evento-id">
            <div class="form-group">
                <label for="evento-tipo">Tipo</label>
                <select id="evento-tipo" required>
                    <option value="Evento">Evento</option>
                    <option value="Programação">Programação</option>
                </select>
            </div>
            <div class="form-group">
                <label for="evento-nome">Nome</label>
                <input type="text" id="evento-nome" required>
            </div>
            <div class="form-group">
                <label for="evento-categoria">Categoria</label>
                <select id="evento-categoria" required>
                    <option value="">Carregando...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="evento-recorrencia">Recorrência (se aplicável)</label>
                <input type="text" id="evento-recorrencia" placeholder="Ex: Toda quinta-feira às 20h">
            </div>
            <div class="form-group-grid">
                <div class="form-group">
                    <label for="evento-data-inicio">Data de Início</label>
                    <input type="datetime-local" id="evento-data-inicio" required>
                </div>
                <div class="form-group">
                    <label for="evento-data-fim">Data de Fim</label>
                    <input type="datetime-local" id="evento-data-fim" required>
                </div>
            </div>
            <div class="form-group">
                <label for="evento-local">Local</label>
                <input type="text" id="evento-local" required>
            </div>
            <div class="form-group">
                <label for="evento-responsavel">Responsável</label>
                <select id="evento-responsavel" required>
                    <option value="">Carregando...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="evento-cor">Cor no Calendário</label>
                <input type="color" id="evento-cor" class="input-cor">
            </div>
                            <div class="form-group">
                                <label for="evento-descricao">Descrição</label>
                                <textarea id="evento-descricao" rows="3"></textarea>
                            </div>
            
                            <!-- NOVO: Campos Financeiros para Eventos -->
                            <div id="financial-fields" style="display: none; border-top: 1px solid var(--cor-borda); padding-top: 15px; margin-top: 15px;">
                                <h4><i class='bx bxs-dollar-circle'></i> Gestão Financeira do Evento</h4>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="evento-envolve-fundos">
                                        Este evento envolve arrecadação de fundos ou tem custos?
                                    </label>
                                </div>
                                <div class="form-group-grid">
                                    <div class="form-group">
                                        <label for="evento-meta">Meta de Arrecadação (R$)</label>
                                        <input type="number" id="evento-meta" step="0.01" placeholder="2500.00">
                                    </div>
                                    <div class="form-group">
                                        <label for="evento-custo">Custo Estimado (R$)</label>
                                        <input type="number" id="evento-custo" step="0.01" placeholder="750.00">
                                    </div>
                                </div>
                            </div>
            
                            <div class="form-group">
                                <label for="evento-cartaz">Cartaz do Evento/Programação</label>
                                <input type="file" id="evento-cartaz-input" accept="image/*">
                                <input type="hidden" id="evento-cartaz-url">
                                <img id="cartaz-preview" src="" alt="Pré-visualização do cartaz" style="max-width: 100%; margin-top: 10px; display: none;">
                            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secundario modal-cancel">Cancelar</button>
                <button type="submit" class="btn btn-principal">Salvar</button>
            </div>
        </form>
    </div>
</div>

<!-- NOVO: Modal de Detalhes do Evento -->
<div id="detalhes-evento-modal" class="modal-overlay">
    <div class="modal-content modal-detalhes">
        <div class="modal-header">
            <h2 id="detalhes-modal-title">Detalhes do Evento</h2>
            <button id="detalhes-modal-close" class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div id="detalhes-cartaz-container">
                <img id="detalhes-cartaz-img" src="" alt="Cartaz do Evento">
            </div>
            <div id="detalhes-info-container">
                <p><strong><i class='bx bx-calendar'></i> Data e Hora:</strong> <span id="detalhes-data"></span></p>
                <p><strong><i class='bx bx-map'></i> Local:</strong> <span id="detalhes-local"></span></p>
                <p><strong><i class='bx bx-user'></i> Responsável:</strong> <span id="detalhes-responsavel"></span></p>
                <p><strong><i class='bx bx-info-circle'></i> Categoria:</strong> <span id="detalhes-categoria"></span></p>
                <p id="detalhes-recorrencia-p" style="display:none;"><strong><i class='bx bx-sync'></i> Recorrência:</strong> <span id="detalhes-recorrencia"></span></p>
                <div id="detalhes-financeiro-container" style="display:none;">
                    <h4><i class='bx bxs-dollar-circle'></i> Detalhes Financeiros</h4>
                    <p><strong>Meta de Arrecadação:</strong> <span id="detalhes-meta"></span></p>
                    <p><strong>Custo Estimado:</strong> <span id="detalhes-custo"></span></p>
                </div>
                <div id="detalhes-descricao-container">
                    <h4>Descrição</h4>
                    <p id="detalhes-descricao"></p>
                </div>
        </div>
        <div class="modal-actions">
            <button id="btn-excluir-evento" class="btn btn-perigo">Excluir</button>
            <div>
                <button id="btn-exportar-ics" class="btn btn-secundario"><i class='bx bx-calendar-plus'></i> Adicionar ao Calendário</button>
                <button id="btn-lembrete" class="btn btn-secundario"><i class='bx bx-bell-plus'></i> Me Lembre</button>
                <button id="btn-editar-evento" class="btn btn-secundario">Editar</button>
                <button id="btn-fechar-detalhes" class="btn btn-principal">Fechar</button>
            </div>
        </div>
    </div>
</div>


<!-- Scripts no final do body -->
<script src="/js/global-loader.js" defer></script>
<script src="/components/notifications.js" defer></script>
    <script src="/pages/config.js"></script>
    <script src="agenda.js"></script>

    <!-- NOVO: Container para o cartaz em tela cheia -->
    <div id="fullscreen-container" class="fullscreen-container">
        <span class="fullscreen-close">&times;</span>
        <img id="fullscreen-image" src="">
    </div>

</body></html>