<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/auth-guard.js"></script>
    <title>Gerenciador de Cartão de Membro</title>
    <link rel="icon" href="/pages/logo.tab.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@600;700&family=Lato:wght@400;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="/pages/styles/global.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/components/menu.css">
    <link rel="stylesheet" href="cartao_membro.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="/auth-guard.js"></script>
</head>
<body>
    <header>
        <nav class="menu">
            <div class="menu-lado-esquerdo">
                <div class="hamburger-menu hamburger-mobile" id="hamburger-btn-mobile"><i class='bx bx-menu'></i></div>
                <img src="/pages/logo.tab.png" alt="logo-tab" width="65" class="menu-logo" id="menu-logo-img" />
                <h3 id="menu-church-name">ADTC - Tabernáculo Celeste</h3>
            </div>
            <div class="menu-acoes">
                <div class="notificacao-container" id="notificacao-container"><i class='bx bxs-bell'></i><span class="notificacao-contador" id="notificacao-contador"></span></div>
                <div class="conta-area" id="conta-area-trigger">
                    <div id="user-avatar" class="user-avatar">U</div>
                </div>
            </div>
        </nav>
        <aside class="sub-menu">
            <div class="hamburger-menu hamburger-desktop" id="hamburger-btn-desktop"><i class='bx bx-menu'></i></div>
            <div class="menu-categorias">
                <a href="/pages/dashboard/dashboard.html" class="sub-menu-link">Dashboard</a>
                <a href="/pages/cadastro.page/cadastro.html" class="sub-menu-link">Cadastro</a>
                <a href="/pages/lista.membros/lista.membros.html" class="sub-menu-link">Membros</a>
                <a href="/pages/financeiro.page/financeiro.html" class="sub-menu-link">Financeiro</a>
                <a href="/pages/utensilios/utensilios.html" class="sub-menu-link">Utensílios</a>
                <a href="/pages/eventos/eventos.html" class="sub-menu-link">Eventos</a>
            </div>
        </aside>
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
        <nav id="sidebar-menu" class="sidebar">
            <div class="sidebar-header">
                <h4>Navegação Principal</h4>
                <i class='bx bx-x' id="sidebar-close-btn"></i>
            </div>
            <ul class="sidebar-links">
                <li><a href="/pages/dashboard/dashboard.html"><i class='bx bxs-dashboard'></i> Dashboard</a></li>
                <li>
                    <details><summary><i class='bx bxs-user-plus'></i> Cadastros</summary>
                        <ul>
                            <li><a href="/pages/cadastro.page/cadastro.html">- Central de Cadastros</a></li>
                            <li><a href="/pages/cadastro.membro.page/cadastro.membro.html">- Novo Membro</a></li>
                            <li><a href="/pages/cadastro.page/visitantes.html">- Visitantes</a></li>
                        </ul>
                    </details>
                </li>
                <li>
                    <details open><summary><i class='bx bxs-group'></i> Membros</summary>
                        <ul><li><a href="/pages/lista.membros/lista.membros.html#lista">- Lista de Membros</a></li><li><a href="/pages/lista.membros/lista.membros.html#presenca">- Controle de Presença</a></li></ul>
                    </details>
                </li>
                <li>
                    <details><summary><i class='bx bxs-dollar-circle'></i> Financeiro</summary>
                        <ul><li><a href="/pages/financeiro.page/financeiro.html#lancamentos">- Lançamentos</a></li><li><a href="/pages/financeiro.page/financeiro.html#dizimos">- Dízimos e Ofertas</a></li></ul>
                    </details>
                </li>
                <li>
                    <details><summary><i class='bx bxs-home-heart'></i> Pequenos Grupos</summary>
                        <ul><li><a href="/pages/pequenos-grupos/pequenos-grupos.html#painel-grupos">- Painel de Grupos</a></li><li><a href="/pages/pequenos-grupos/pequenos-grupos.html#analise-geral">- Análise Geral</a></li></ul>
                    </details>
                </li>
                <li>
                    <details><summary><i class='bx bxs-box'></i> Utensílios</summary>
                        <ul><li><a href="/pages/utensilios/utensilios.html#inventario">- Inventário</a></li><li><a href="/pages/utensilios/utensilios.html#emprestimos">- Empréstimos</a></li><li><a href="/pages/utensilios/utensilios.html#manutencao">- Manutenção</a></li></ul>
                    </details>
                </li>
                <li>
                    <details><summary><i class='bx bxs-calendar-event'></i> Eventos</summary>
                        <ul><li><a href="/pages/eventos/eventos.html#painel">- Painel de Eventos</a></li></ul>
                    </details>
                </li>
                <hr>
                <li><a href="/pages/configuracoes/configuracoes.html"><i class='bx bxs-cog'></i> Configurações</a></li>
                <li>
                    <details><summary><i class='bx bxs-info-circle'></i> Sobre</summary>
                        <div class="sidebar-sobre"><p><strong>Versão:</strong> 1.0.0</p><a href="#" target="_blank">Site do Desenvolvedor</a></div>
                    </details>
                </li>
            </ul>
        </nav>
    </header>

    <main class="main-content">
        <div class="page-header">
            <div class="header-actions">
                <button id="btn-back" class="btn-icon btn-back" title="Voltar"><i class='bx bx-arrow-back'></i></button>
                <h1>Cartão de Membro</h1>
            </div>
            <div class="header-actions">
                <button id="btn-print-multiple" class="btn btn-secondary"><i class='bx bxs-group'></i> Impressão em Lote</button>
                <button id="btn-download" class="btn btn-secondary"><i class='bx bxs-download'></i> Baixar</button>
                <button id="btn-print" class="btn btn-primary"><i class='bx bxs-printer'></i> Imprimir</button>
            </div>
        </div>

        <div class="editor-container">
            <!-- Coluna de Controles -->
            <aside class="control-panel">
                <div class="control-section">
                    <label class="control-label">Modo de Visualização</label>
                    <div class="segmented-control">
                        <input type="radio" name="view-switch" id="view-physical" value="physical" checked>
                        <label for="view-physical">Físico</label>
                        <input type="radio" name="view-switch" id="view-virtual" value="virtual">
                        <label for="view-virtual">Virtual</label>
                    </div>
                </div>

                <div id="customize-panel" class="customize-panel">
                    <h4>Estilo do Cartão</h4>
                    <div class="form-group color-selector-group">
                        <div class="color-input-wrapper">
                            <label for="color-primary">Principal</label>
                            <input type="color" id="color-primary" value="#1a2a4c" title="Cor Principal">
                        </div>
                        <div class="color-input-wrapper">
                            <label for="color-secondary">Destaque</label>
                            <input type="color" id="color-secondary" value="#f0a500" title="Cor de Destaque">
                        </div>
                        <div class="color-input-wrapper">
                            <label for="color-text">Texto</label>
                            <input type="color" id="color-text" value="#ffffff" title="Cor do Texto">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="congregacao-text">Texto da Congregação</label>
                        <input type="text" id="congregacao-text" value="CONGREGAÇÃO SEDE">
                    </div>

                    <div class="form-group">
                        <label for="font-select">Fonte do Cartão</label>
                        <select id="font-select">
                            <option value="'Poppins', sans-serif">Poppins</option>
                            <option value="'Roboto', sans-serif">Roboto</option>
                            <option value="'Lato', sans-serif">Lato</option>
                            <option value="'Montserrat', sans-serif">Montserrat</option>
                        </select>
                    </div>

                    <h4>Fundo do Cartão</h4>
                    <div class="form-group">
                        <div class="gallery-header">
                            <label>Galeria</label>
                            <button id="btn-clear-gallery" class="btn-link" title="Limpar imagens personalizadas"><i class='bx bx-trash'></i> Limpar</button>
                        </div>
                        <div class="background-gallery" id="background-gallery">
                            <div class="gallery-item active" data-bg="var(--card-color-primary)" style="background: var(--card-color-primary);"></div>
                            <button id="btn-add-background" class="gallery-item add-item" title="Adicionar Imagem de Fundo"><i class='bx bx-plus'></i></button>
                        </div>
                        <input type="file" id="background-upload" accept="image/*" style="display: none;">
                    </div>

                    <h4>Padrões (Presets)</h4>
                    <div class="form-group">
                        <label for="preset-load">Carregar Padrão</label>
                        <select id="preset-load"></select>
                    </div>
                    <div class="form-group">
                        <label for="preset-save-name">Salvar Padrão Atual como</label>
                        <div class="preset-manager">
                            <input type="text" id="preset-save-name" placeholder="Ex: Padrão 2025">
                            <button id="btn-save-preset" class="btn btn-primary"><i class='bx bx-save'></i></button>
                        </div>
                    </div>
                    <div class="preset-controls">
                        <button id="btn-delete-preset" class="btn btn-danger"><i class='bx bxs-trash'></i> Excluir Padrão</button>
                    </div>
                </div>
            </aside>

            <!-- Área de Visualização -->
            <section class="display-area">
                <div class="card-viewport">
                    <div id="physical-card-preview" class="card-preview active">
                        <div id="card-front" class="card physical-card"></div>
                        <div id="card-back" class="card physical-card"></div>
                    </div>
                    <div id="virtual-card-preview" class="card-preview">
                        <div id="virtual-card" class="card virtual-card">
                            <div class="card-bg"></div>
                            <div class="virtual-card-header"><img src="/pages/logo.tab.png" alt="Logo" class="logo"><h3>ADTC - Tabernáculo Celeste</h3></div>
                            <div class="member-photo" id="member-photo-virtual"></div>
                            <h2 id="member-name-virtual">Nome do Membro</h2>
                            <p id="member-role-virtual">Cargo</p>
                            <div class="virtual-card-info-grid">
                                <p><span>RG</span><span id="member-rg-virtual">...</span></p>
                                <p><span>CPF</span><span id="member-cpf-virtual">...</span></p>
                                <p><span>Nascimento</span><span id="member-birthdate-virtual">...</span></p>
                                <p><span>Estado Civil</span><span id="member-marital-status-virtual">...</span></p>
                            </div>
                            <div class="qr-code-container" id="qr-code-virtual"></div>
                            <div class="virtual-card-footer"><p>Validade: <span id="card-validity-virtual">...</span></p></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <div id="print-modal-backdrop" class="modal-backdrop" style="display: none;">
        <div id="print-modal" class="modal">
            <h2>Impressão em Lote</h2>
            <p>Selecione os membros que deseja imprimir o cartão.</p>
            <div class="form-group">
                <input type="text" id="member-search-input" placeholder="Buscar membro por nome...">
            </div>
            <div id="member-selection-list" class="member-selection-list"></div>
            <div class="modal-actions">
                <button id="btn-cancel-batch-print" class="btn btn-secondary">Cancelar</button>
                <button id="btn-confirm-batch-print" class="btn btn-primary">Gerar Impressão</button>
            </div>
        </div>
    </div>

    <div id="modal-cropper-bg" class="modal-backdrop" style="display: none;">
        <div class="modal">
            <h2>Ajustar Imagem de Fundo</h2>
            <div class="cropper-container">
                <img id="image-to-crop-bg" src="">
            </div>
            <div class="modal-actions">
                <button id="btn-cancelar-crop-bg" class="btn btn-secondary">Cancelar</button>
                <button id="btn-cortar-bg" class="btn btn-primary">Cortar e Usar</button>
            </div>
        </div>
    </div>

    <!-- Modal da Conta do Usuário (para ser usado em todas as páginas) -->
    <div id="modal-conta-usuario" class="modal-overlay">
        <div class="modal-content modal-sm">
            <button class="modal-close" data-close-modal="modal-conta-usuario">&times;</button>
            <div class="conta-modal-header">
                <div id="conta-modal-avatar" class="user-avatar-large">U</div>
                <h3 id="conta-modal-nome">Nome do Usuário</h3>
                <p id="conta-modal-email">email@exemplo.com</p>
                <span id="conta-modal-role" class="badge">Administrador</span>
            </div>
            <div class="conta-modal-body">
                <a href="/pages/configuracoes/configuracoes.html#perfil" class="btn-modal-conta"><i class='bx bxs-user-cog'></i> Gerenciar Perfil</a>
                <a href="#" id="btn-modal-logout" class="btn-modal-conta btn-perigo"><i class='bx bx-log-out'></i> Sair</a>
            </div>
        </div>
    </div>

    <script src="/pages/config.js"></script>
    <script src="/components/menu.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="cartao_membro.js"></script>
</body>
</html>