<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/preload.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/auth-guard.js"></script>
    <link rel="stylesheet" href="/pages/styles/global.css">
    <link rel="stylesheet" href="/components/menu.css">
    <link rel="stylesheet" href="/components/notifications.css">
</head>
<body hx-boost="true" hx-ext="preload">
    <!-- Barra de Progresso do HTMX -->
    <div class="htmx-indicator"></div>
    <link rel="stylesheet" href="/pages/lista.membros/lista.membros.css">
    <header id="menu-placeholder"></header>    <main class="conteudo">
        <div class="page-header-wrapper" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
            <h1 class="title-page" style="margin-bottom: 0;">Gerenciamento de Membros</h1>
            <div class="header-actions">
                <button class="btn-principal" onclick="window.location.href='../cadastro.membro.page/cadastro.membro.html'">+ Novo Membro</button>
                <button class="btn-secundario btn-relatorio"><i class='bx bxs-file-pdf'></i> Relatório</button>
                <button class="btn-secundario" id="btn-share-link" title="Copiar Link de Cadastro Público"><i class='bx bx-share-alt'></i> Link Público</button>
            </div>
        </div>

        <nav class="abas-navegacao">
            <button class="aba-link active" data-aba="lista">Lista de Membros</button>
            <button class="aba-link" data-aba="presenca">Controle de Presença</button>
            <button class="aba-link" data-aba="engajamento">Análise de Engajamento</button>
        </nav>

        <!-- Aba 1: Lista de Membros -->
        <div id="lista" class="aba-conteudo active">
            <div class="acoes-header">
                <div class="filtros-container">
                    <input type="text" id="filtro-nome" placeholder="Buscar por nome, CPF...">
                    <button id="btn-filtros-avancados" class="btn-secundario" title="Filtros Avançados">
                        <i class='bx bx-filter-alt'></i> Filtros
                    </button>
                </div>
            </div>
            <div class="tabela-wrapper">
                <table class="tabela-dados">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Nome</th>
                            <th>Status</th>
                            <th>Cargo</th>
                            <th>Telefone</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody class="membros-lista">
                        <!-- Conteúdo da lista de membros -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Aba 2: Controle de Presença -->
        <div id="presenca" class="aba-conteudo">
            <div class="presenca-header">
                <h2>Registrar Presença no Culto</h2>
                <div class="filtro-grupo">
                    <label for="data-culto">Selecione a data:</label>
                    <input type="date" id="data-culto">
                </div>
                <div class="filtro-grupo">
                    <label for="busca-presenca">Buscar membro:</label>
                    <input type="text" id="busca-presenca" placeholder="Nome ou telefone...">
                </div>
            </div>
            <div id="lista-presenca-container"></div>
            <div class="presenca-footer">
                <button id="btn-salvar-presenca" class="btn-principal" disabled>Salvar Presenças</button>
            </div>
        </div>

        <!-- Aba 3: Análise de Engajamento -->
        <div id="engajamento" class="aba-conteudo">
            <div class="ranking-wrapper">
                <h2><i class='bx bxs-star'></i> Ranking de Engajamento</h2>
                <p class="subtitulo-ranking">Membros com maior frequência nos cultos (últimos 3 meses).</p>
                <ol id="lista-ranking-engajamento">
                    <!-- Ranking será preenchido via JS -->
                </ol>
            </div>
        </div>
    </main>

    <!-- Modal de Compartilhamento -->
    <div id="modal-share" class="modal-overlay">
        <div class="modal-content share-modal-content">
            <button class="modal-close" id="btn-close-share">&times;</button>
            <div class="share-header">
                <div class="share-icon-circle">
                    <i class='bx bxs-share-alt'></i>
                </div>
                <h2>Compartilhar Cadastro</h2>
                <p>Envie este link para novos membros se cadastrarem.</p>
            </div>
            
            <div class="share-input-group">
                <input type="text" id="share-link-input" readonly>
                <button id="btn-copy-modal" title="Copiar Link"><i class='bx bx-copy'></i></button>
            </div>

            <button id="btn-native-share" class="btn-principal full-width-btn">
                <i class='bx bxl-whatsapp'></i> Compartilhar via App
            </button>
        </div>
    </div>

    <!-- Modal de Filtros Avançados -->
    <div id="modal-filtros" class="modal-overlay">
        <div class="modal-content filtros-modal-content">
            <div class="modal-header">
                <h2>Filtros Avançados</h2>
                <button class="modal-close" id="btn-close-filtros">&times;</button>
            </div>
            <form id="form-filtros">
                <div class="filtros-grid">
                    <div class="form-group">
                        <label for="f-status">Status</label>
                        <select id="f-status" name="status">
                            <option value="">Todos</option>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-genero">Gênero</label>
                        <select id="f-genero" name="genero">
                            <option value="">Todos</option>
                            <option value="masculino">Masculino</option>
                            <option value="feminino">Feminino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-cargo">Cargo Eclesiástico</label>
                        <select id="f-cargo" name="cargoEclesiastico">
                            <option value="">Todos</option>
                            <option value="membro">Membro</option>
                            <option value="obreiro">Obreiro</option>
                            <option value="diacono">Diácono</option>
                            <option value="diaconisa">Diaconisa</option>
                            <option value="presbitero">Presbítero</option>
                            <option value="evangelista">Evangelista</option>
                            <option value="pastor">Pastor</option>
                            <option value="musico">Músico</option>
                            <option value="missionaria">Missionária</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-estado-civil">Estado Civil</label>
                        <select id="f-estado-civil" name="estadoCivil">
                            <option value="">Todos</option>
                            <option value="solteiro">Solteiro(a)</option>
                            <option value="casado">Casado(a)</option>
                            <option value="divorciado">Divorciado(a)</option>
                            <option value="viuvo">Viúvo(a)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-ministerio">Ministério</label>
                        <select id="f-ministerio" name="temMinisterio">
                            <option value="">Todos</option>
                            <option value="sim">Participa</option>
                            <option value="nao">Não Participa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-batismo">Batismo nas Águas</label>
                        <select id="f-batismo" name="batismoAguas">
                            <option value="">Todos</option>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-dizimista">Dizimista</label>
                        <select id="f-dizimista" name="eDizimista">
                            <option value="">Todos</option>
                            <option value="true">Sim</option>
                            <option value="false">Não</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="f-faixa-etaria">Faixa Etária</label>
                        <select id="f-faixa-etaria" name="faixaEtaria">
                            <option value="">Todas</option>
                            <option value="0-11">Crianças (0-11)</option>
                            <option value="12-17">Adolescentes (12-17)</option>
                            <option value="18-29">Jovens (18-29)</option>
                            <option value="30-59">Adultos (30-59)</option>
                            <option value="60+">Idosos (60+)</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer-actions">
                    <button type="button" id="btn-limpar-filtros" class="btn-secundario">Limpar Filtros</button>
                    <button type="submit" class="btn-principal">Aplicar Filtros</button>
                </div>
            </form>
        </div>
    </div>

<script src="/js/global-loader.js" defer></script>

<script src="/js/api.js"></script>

<script src="/pages/lista.membros/lista.membros.js"></script> <!-- Caminho já estava correto, confirmando -->
</body>
</html>