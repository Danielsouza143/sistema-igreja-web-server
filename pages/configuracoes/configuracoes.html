<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - Gestão ADTC</title>
    <script src="/auth-guard.js"></script> <!-- GUARDA DE ROTA -->
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <link rel="stylesheet" href="configuracoes.css">
    <link rel="stylesheet" href="/pages/styles/global.css"> 
    <link rel="stylesheet" href="/components/menu.css">
    <link rel="stylesheet" href="/components/notifications.css">

    <!-- Cropper.js for logo cropping -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js" defer></script>
</head>
<body data-theme="light">
    <header id="menu-placeholder"></header>

    <main class="conteudo">
        <div class="config-container">
            <aside class="config-nav">
                <ul>
                    <li><a href="#perfil" class="config-nav-link active"><i class='bx bxs-user-circle'></i> Meu Perfil</a></li>
                    <li><a href="#aparencia" class="config-nav-link"><i class='bx bxs-palette'></i> Aparência</a></li>
                    <li><a href="#identidade" class="config-nav-link"><i class='bx bxs-church'></i> Identidade da Igreja</a></li>
                    <li><a href="#usuarios" class="config-nav-link"><i class='bx bxs-user-account'></i> Gerenciar Usuários</a></li>
                    <li><a href="#categorias" class="config-nav-link"><i class='bx bxs-category'></i> Categorias</a></li>
                    <li><a href="#backup" class="config-nav-link"><i class='bx bxs-data'></i> Backup e Restauração</a></li>
                    <li><a href="#logs" class="config-nav-link"><i class='bx bx-history'></i> Logs do Sistema</a></li>
                </ul>
            </aside>

            <div class="config-content">
                <!-- Seção: Meu Perfil -->
                <section id="perfil" class="config-section active">
                    <h1 class="title-page">Meu Perfil</h1>
                    <form id="form-perfil">
                        <div class="config-card">
                            <h3><i class='bx bx-user-circle'></i> Informações do Usuário</h3>
                            <div class="form-group">
                                <label for="perfil-nome-completo">Nome Completo</label>
                                <input type="text" id="perfil-nome-completo">
                            </div>
                            <div class="form-group">
                                <label for="perfil-username">Nome de Usuário (Login)</label>
                                <input type="text" id="perfil-username" readonly>
                            </div>
                            <button type="submit" class="btn-principal" id="btn-salvar-perfil">Salvar Nome</button>
                        </div>
                        <div class="config-card">
                            <h3><i class='bx bx-key'></i> Alterar Senha</h3>
                            <div class="form-group"><label for="perfil-senha-atual">Senha Atual</label><input type="password" id="perfil-senha-atual" placeholder="••••••••"></div>
                            <div class="form-group"><label for="perfil-nova-senha">Nova Senha</label><input type="password" id="perfil-nova-senha" placeholder="••••••••"></div>
                            <div class="form-group"><label for="perfil-confirmar-senha">Confirmar Nova Senha</label><input type="password" id="perfil-confirmar-senha" placeholder="••••••••"></div>
                            <button type="button" id="btn-salvar-senha" class="btn-principal">Salvar Nova Senha</button>
                        </div>
                    </form>
                </section>

                <!-- Seção: Aparência -->
                <section id="aparencia" class="config-section">
                    <h1 class="title-page">Aparência</h1>
                    <div class="config-card">
                        <h3><i class='bx bx-palette'></i> Personalização da Interface</h3>
                        <div class="form-group">
                            <label>Tema da Interface</label>
                            <div class="theme-switcher">
                                <button data-theme="light" class="theme-btn active">Claro</button>
                                <button data-theme="dark" class="theme-btn">Escuro</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cor-principal">Cor Principal</label>
                            <input type="color" id="cor-principal" value="#001f5d">
                        </div>
                    </div>
                </section>

                <!-- Seção: Identidade da Igreja -->
                <section id="identidade" class="config-section">
                    <h1 class="title-page">Identidade da Igreja</h1>
                    <div class="config-card">
                        <h3><i class='bx bxs-church'></i> Nome e Logo</h3>
                        <div class="form-group">
                            <label for="config-nome-igreja">Nome da Igreja</label>
                            <input type="text" id="config-nome-igreja" placeholder="Nome completo da sua igreja">
                        </div>
                        <div class="form-group">
                            <label>Logo da Igreja</label>
                            <div class="logo-preview-container">
                                <i id="logo-preview" class='bx bx-church' style="font-size: 100px;"></i>
                            </div>
                            <input type="file" id="logo-upload-input" accept="image/png, image/jpeg" style="display: none;">
                            <div class="logo-actions">
                                <button type="button" id="btn-trocar-logo" class="btn btn-secundario">Trocar Logo</button>
                                <button type="button" id="btn-salvar-identidade" class="btn btn-principal">Salvar Identidade</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Seção: Gerenciar Usuários -->
                <section id="usuarios" class="config-section">
                    <h1 class="title-page">Gerenciamento de Usuários</h1>
                    <div class="config-card full-width">
                        <p>Adicione, edite ou remova usuários que podem acessar o sistema.</p>
                        <div class="header-actions">
                            <button id="btn-novo-usuario" class="btn-principal"><i class='bx bx-plus'></i> Adicionar Usuário</button>
                        </div>
                        <ul id="lista-usuarios" class="lista-configs"></ul>
                    </div>
                </section>

                <!-- Seção: Categorias -->
                <section id="categorias" class="config-section">
                    <h1 class="title-page">Central de Categorias</h1>
                    <div id="categorias-container" class="config-card full-width">
                        <div class="categorias-container">
                            <div class="categoria-coluna">
                                <h4><i class='bx bxs-coffee-togo'></i> Utensílios</h4>
                                <ul id="lista-cat-utensilios" class="lista-configs"></ul>
                                <div class="add-config-form"><input type="text" id="nova-cat-utensilios_categorias" placeholder="Nova categoria"><button data-tipo="utensilios_categorias" class="btn-add-categoria btn-principal">Adicionar</button></div>
                            </div>
                            <div class="categoria-coluna">
                                <h4><i class='bx bxs-calendar-event'></i> Eventos</h4>
                                <ul id="lista-cat-eventos" class="lista-configs"></ul>
                                <div class="add-config-form"><input type="text" id="nova-cat-eventos_categorias" placeholder="Nova categoria"><button data-tipo="eventos_categorias" class="btn-add-categoria btn-principal">Adicionar</button></div>
                            </div>
                            <div class="categoria-coluna">
                                <h4><i class='bx bxs-dollar-circle'></i> Financeiro (Entradas)</h4>
                                <ul id="lista-cat-entradas" class="lista-configs"></ul>
                                <div class="add-config-form"><input type="text" id="nova-cat-entradas" placeholder="Nova categoria"><button data-tipo="financeiro_categorias" data-subtipo="entradas" class="btn-add-categoria btn-principal">Adicionar</button></div>
                            </div>
                            <div class="categoria-coluna">
                                <h4><i class='bx bxs-dollar-circle'></i> Financeiro (Saídas)</h4>
                                <ul id="lista-cat-saidas" class="lista-configs"></ul>
                                <div class="add-config-form"><input type="text" id="nova-cat-saidas" placeholder="Nova categoria"><button data-tipo="financeiro_categorias" data-subtipo="saidas" class="btn-add-categoria btn-principal">Adicionar</button></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Seção: Backup e Restauração -->
                <section id="backup" class="config-section">
                    <h1 class="title-page">Backup e Restauração</h1>
                    <div class="config-card">
                        <h3><i class='bx bx-data'></i> Cópia de Segurança</h3>
                        <p>Salve todos os dados do sistema em um arquivo seguro ou restaure a partir de um backup anterior.</p>
                        <div class="backup-actions">
                            <button id="btn-exportar-dados" class="btn-principal">Exportar Dados (Backup)</button>
                            <button id="btn-importar-dados" class="btn-secundario">Importar Dados (Restaurar)</button>
                            <input type="file" id="import-file-input" style="display: none;" accept=".json">
                        </div>
                    </div>
                </section>

                <!-- Seção: Logs do Sistema -->
                <section id="logs" class="config-section">
                    <h1 class="title-page">Log de Atividades do Sistema</h1>
                    <div class="config-card full-width">
                        <p>Últimas 200 ações realizadas no sistema. Apenas administradores podem ver esta seção.</p>
                        <div id="log-container">
                            <ul id="lista-logs" class="lista-configs">
                                <li class="mensagem-vazio">Carregando logs...</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Modal para Usuários -->
    <div id="modal-usuario" class="modal-overlay">
        <div class="modal-content">
            <form id="form-usuario">
                <h2 id="modal-usuario-titulo">Adicionar Usuário</h2>
                <input type="hidden" id="usuario-id">
                <div class="form-group"><label for="usuario-nome-completo">Nome Completo</label><input type="text" id="usuario-nome-completo"></div>
                <div class="form-group"><label for="usuario-username">Nome de Usuário</label><input type="text" id="usuario-username" required></div>
                <div class="form-group"><label for="usuario-password">Senha</label><input type="password" id="usuario-password" placeholder="Deixe em branco para não alterar"></div>
                <div class="form-group"><label for="usuario-role">Permissão</label>
                    <select id="usuario-role" required><option value="operador">Operador</option><option value="admin">Administrador</option></select>
                </div>
                <div class="modal-actions"><button type="button" class="btn-secundario" data-close-modal="modal-usuario">Cancelar</button><button type="submit" class="btn-principal">Salvar</button></div>
            </form>
        </div>
    </div>

    <!-- Modal da Conta do Usuário (para ser usado em todas as páginas) -->
    <div id="modal-conta-usuario" class="modal-overlay">
        <div class="modal-content modal-sm">
            <button class="modal-close" data-close-modal="modal-conta-usuario">&times;</button>
            <div class="conta-modal-header">
                <div id="conta-modal-avatar" class="user-avatar-large">U</div>
                <h3 id="conta-modal-nome">Nome do Usuário</h3>
                <p id="conta-modal-email">email@exemplo.com</p>
                <span id="conta-modal-role" class="badge">Administrador</span>
            </div>
            <div class="conta-modal-body">
                <a href="/pages/configuracoes/configuracoes.html#perfil" class="btn-modal-conta"><i class='bx bxs-user-cog'></i> Gerenciar Perfil</a>
                <a href="#" id="btn-modal-logout" class="btn-modal-conta btn-perigo"><i class='bx bx-log-out'></i> Sair</a>
            </div>
        </div>
    </div>

    <script src="/js/global-loader.js" defer></script>
    
    <script src="configuracoes.js"></script>

    <!-- Modal para Cortar Logo -->
    <div id="modal-crop-logo" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Cortar Logo</h2>
                <button type="button" class="btn-fechar-modal" data-close-modal="modal-crop-logo">&times;</button>
            </div>
            <div class="crop-container">
                <img id="image-to-crop" src="" alt="Imagem para cortar">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secundario" data-close-modal="modal-crop-logo">Cancelar</button>
                <button type="button" id="btn-confirmar-corte" class="btn btn-principal">Confirmar Corte</button>
            </div>
        </div>
    </div>
</body>
</html>
